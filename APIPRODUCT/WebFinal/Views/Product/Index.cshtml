
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Index</h2>
<div>
    <button id="loadBtn" class="btn btn-info">Load Data...</button>
    <button id="createBtn" class="btn btn-primary">Create Product</button>
</div>
<table class="table" id="myTable">
    <thead>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @*<tr>
            <td class="productId">1</td>
            <td class="productName" contenteditable="false">Samsung</td>
            <td class="productPrice"><input type="number", value="300" disabled /></td>
            <td class="productQuantity"><input type="number", value="3" disabled/></td>
            <td class="productTotal">100</td>
        </tr>*@

        
    </tbody>
</table>


@section MyScripts{
    
    <script>
        $("#loadBtn").on("click", function onLoadDataHandler(event) {
            var settings = {
                "url": "https://localhost:44336/ProductAPI/GetAllProducts",
                "method": "GET",
                "timeout": 0,
            };

            $.ajax(settings).done(function (products) {
                $("table > tbody").empty();
                products.forEach(CreateRow);
            }).fail(function () {

            });
        });



        function CreateRow(pro) {
            let template = `
                            <tr>
                                <td class="productId">${pro.Id}</td>
                                <td class="productName" contenteditable="false">${pro.Name}</td>
                                <td class="productPrice"><input type="number" value=${pro.Price} disabled /></td>
                                <td class="productQuantity"><input type="number" value=${pro.Quantity} disabled/></td>
                                <td class="productTotal">100</td>
                                <td>
                                    <button class="productEdit btn btn-success">Edit</button>
                                    <button onclick="onDeleteProductHandler(this,${pro.Id})" class="productDelete btn btn-danger">Delete</button>

                                </td>
                            </tr>
                            `
            // add template in dom
            let ele = $(template);

            $("table > tbody").append(template);


        }






        // Handler for Delete
        function onDeleteProductHandler(e, id) {
            var settings = {
                "url": "https://localhost:44336/ProductAPI/GetProductById?id="+ id,
                "method": "GET",
                "timeout": 0,
            };

            $.ajax(settings).done(function (product) {
                console.log(product);
            }).fail(function () {
                alert("Server error");
            });
        }




    </script>
    
}